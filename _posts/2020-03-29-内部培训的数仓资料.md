---
layout:     post
title:      内部培训的数仓资料
subtitle:   
date:       2020-03-23
author:     ls_oyang
header-img: img/post-bg-BJJ.jpg
catalog: true
tags:
    -数仓 -数仓架构
---

————————————图片太多没放进来后面附上幕布的链接

数仓

- 为什么需要数据仓库，什么是数据仓库，有什么用

- - 我需要掌控数据的变化，为运营决策提供依据
  - 定义：面向主题的，集成的，相对稳定的，反应**历史变化**的数据集合
  - BI/报表、用户画像、精准推送、大屏展示，机器学习

- 数据仓库和数据库的区别

- - oltp和olap，面向事务和面向查询
  - 数据量大小不同
  - 写模式和读模式
  - 建模方法不同
  - 数据生命周期不同。数据库存的数据的生命周期比较短，不会保存很久的数据。数据仓库则需要历史数据来反映趋势的变化和数据分析。

- 数仓理论

- - 理论流派

  - - 比尔恩门

    - - 《数据仓库         : （原书第4版）》《DW2.0         : 下一代数据仓库的构架》
      - 比尔·恩门Inmon         提出的集线器的自上而下（EDW-DM）的数据仓库架构。操作型或事务型系统的数据源，通过ETL抽取转换和加载到数据仓库的ODS层，然后通过ODS的数据建设原子数据的数据仓库EDW，EDW不是多维格式的，不方便上层应用做数据分析，所以需要通过汇总建设成多维格式的数据集市层。优势：易于维护，高度集成；劣势：结构死板，部署周期较长

    - 金博尔

    - - 《数据仓库工具箱（第3版）         : 维度建模权威指南》《数据仓库生命周期工具箱》
      - Kimball提出的总线式的自下而上（DM-DW）的数据仓库架构。kimball多维体系架构的三个关键性指标：总线架构，一致性维度，一致性事实。ODS的数据，利用维度建模方法建设一致维度的数据集市。通过一致性维度可以将数据集市联系在一起，由所有的数据集市组成数据仓库。优势：构建迅速，最快的看到投资回报率，敏捷灵活；劣势：作为企业资源不太好维护，结构复杂，数据集市集成困难。

    - 数仓的建模或者分层，其实都是为了更好的去组织、管理、维护数据，实际开发时会**整合****2****种方式**去使用。

  - 范式建模

  - - 第一范式核心：属性不可分割

    - 第二范式原则：不能存在部分依赖

    - - ·不符合第二范式
      - 符合第二范式

    - 第三范式：不存在传递依赖

    - - 不符合
      - 符合

  - 维度建模

  - - 星型模型
    - 雪花模型
    - 星座模型
    - 设计步骤：确定业务过程        --> 确定粒度        --> 确定维度        --> 确定事实

·        数仓开发

·        我们面临的最直接需要解决的问题：我们有一堆数据，我们需要求想要的指标，怎么办？

·        最初面临的问题

·        我们现在面临的问题，数据同步和数据清洗已经有人做了

·        一般步骤

·        业务调研，垂域模型

·        需求调研，以前，现在，以后

·        数据调研，指标拆解

·        分层

·        为什么要分层

·        复杂问题简单化

·        减少重复开发

·        隔离原始数据

·        ods存储层

·        对ODS层数据进行清洗（去除空值，脏数据，超过极限范围的数据，行式存储改为列存储，改压缩格式）。

·        dwd(dw)明细层 

·        维度建模 范式建模

·        表设计

·        表分类

·        实体表（用户，商家，商品）

·        维度表（性别，地域，商品类目）

·        退化维度

·        将一些简单的维度放在事实表当中（例如性别）

·        缓慢变化维度

·        重写维度值：这种方式直接覆盖原数据

·        插入新维度行：可以保留历史数据，但不能将变化前后的事实数据归一化

·        添加维度列：添加一个新列表示当前类目

·        事实表（一个事实表只能有一个粒度）

·        **事务性事实表**（交易流水表）

·        样例：

·        **周期性快照事实表**

·        统计的是间隔周期内的度量统计，如历史至今、自然年至今、季度至今等等

·        周期快照表没有粒度的概念，取而代之的是周期+状态度量的组合，如历史至今的订单总数

·        事实事务表是稀疏表，周期快照表是稠密表

·        样例（历史至今的订单总数）

·        **累积快照事实表**

·        累计快照事实表中的数据实例会定期更新

·        样例（订单表）（下单、支付、发货、确认）

·        表的同步策略

·        几种同步策略

·        全量表：存储完整的数据

·        增量表：存储新增的数据

·        新增及变化表：存储新增加的和变化的数据

·        拉链表:对新增和变化表做定期合并

·        不同表的同步策略

·        实体表同步策略：每日全量

维度表同步策略：

·        事务性事实表同步策略：每日增量

·        周期性事实表同步策略：每日新增和变化、拉链表

·        dws(dm)汇总层 

·        主题宽表 

·        ads应用层

·        案例

·         

  ·        用户画像项目       相关但暂时不是我们工作重点     数据收集   数据清洗   数据治理       数据质量    元数据    数据审计         数据权限     数据 安全        数据生命周期管理       精进的方向     熟悉业务流程   熟悉表、字段，表与表之间的关系   精通hive sql   快速判断现有数据能否提取所需指标，如果可以，hive       sql    练习     table:       dwd_userlogin_dm             分析最近七天内连续三天活跃用户数？       1）查询出最近7天的活跃用户，并对用户活跃日期进行排名    2）计算用户活跃日期及排名之间的差值    3）对同用户及差值分组，统计差值个数    4）将差值相同个数大于等于3的数据取出，然后去重，即为连续3天及以上活跃的用户            

——————————————本文有图版链接：

[幕布版]: https://mubu.com/doc/34jlKDEEfqb